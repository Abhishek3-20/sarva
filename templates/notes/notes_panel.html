<!-- Floating Notes Button -->
<button onclick="toggleNotes()" 
    class="fixed bottom-6 right-6 z-50 rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
    style="background-color: #B0C4B1; color: white;">
    <!-- Inline SVG Icon -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
        stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 6.75h15m-15 4.5h15m-15 4.5h15"/>
    </svg>
</button>

<!-- Notes Drawer -->
<div id="notes-panel" 
    class="fixed bottom-0 right-0 w-96 transform translate-y-full transition-transform duration-300 shadow-xl border-l border-t"
    style="background-color: #F7E1D7; color: #4A5759; border-color: #ccc;">

    <!-- Header -->
    <div class="p-4 flex justify-between items-center border-b" style="border-color: #ccc;">
        <h2 class="font-bold text-lg">My Notes</h2>
        <button onclick="toggleNotes()" 
            class="px-2 py-1 rounded" 
            style="background-color: #E67A7A; color: white;">Close</button>
    </div>

    <!-- Notes list -->
    <div class="p-4 space-y-3 overflow-y-auto" style="max-height: 240px;" id="notes-list"></div>

    <!-- New note input -->
    <div class="p-4 border-t" style="border-color: #ccc;">
        <textarea id="note-content" 
            class="w-full p-2 rounded border" 
            style="background-color: white; color: black; border-color: #ccc;" 
            placeholder="Write a note..."></textarea>
        <button onclick="saveNote()" 
            class="mt-3 w-full px-3 py-2 rounded" 
            style="background-color: #B0C4B1; color: #4A5759;">Save</button>
    </div>
</div>

<script>
function toggleNotes() {
    const panel = document.getElementById('notes-panel');
    panel.classList.toggle('translate-y-full');
}

function loadNotes() {
    fetch('/notes/get/')
        .then(res => res.json())
        .then(data => {
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            data.notes.forEach(note => {
                list.innerHTML += `
                    <div class="p-2 rounded shadow flex justify-between items-start" 
                         style="background-color: white; color: black;">
                        <div class="flex-1 break-words" id="note-content-${note.id}">
                            ${note.content}
                        </div>
                        <div class="flex flex-col gap-1 ml-2">
                            <button class="px-1 py-0.5 rounded" style="background-color: #FFD580; color: black;" 
                                onclick="editNotePrompt(${note.id}, '${note.content.replace(/'/g, "\\'")}')">‚úè</button>
                            <button class="px-1 py-0.5 rounded" style="background-color: #E67A7A; color: white;" 
                                onclick="deleteNote(${note.id})">üóë</button>
                        </div>
                    </div>
                `;
            });
        });
}

function saveNote() {
    const content = document.getElementById('note-content').value;
    if (content.trim() === '') return;
    fetch('/notes/save/', {
        method: 'POST',
        headers: {'X-CSRFToken': getCookie('csrftoken')},
        body: new URLSearchParams({'content': content})
    }).then(() => {
        document.getElementById('note-content').value = '';
        loadNotes();
    });
}

function editNotePrompt(noteId, oldContent) {
    const newContent = prompt("Edit your note:", oldContent);
    if (newContent && newContent.trim() !== '') {
        fetch(`/notes/edit/${noteId}/`, {
            method: 'POST',
            headers: {'X-CSRFToken': getCookie('csrftoken')},
            body: new URLSearchParams({'content': newContent})
        }).then(() => loadNotes());
    }
}

function deleteNote(noteId) {
    if (confirm("Are you sure you want to delete this note?")) {
        fetch(`/notes/delete/${noteId}/`, {
            method: 'POST',
            headers: {'X-CSRFToken': getCookie('csrftoken')}
        }).then(() => loadNotes());
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        document.cookie.split(';').forEach(cookie => {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            }
        });
    }
    return cookieValue;
}

document.getElementById('notes-panel').addEventListener('transitionend', function() {
    if (!this.classList.contains('translate-y-full')) loadNotes();
});
</script>
