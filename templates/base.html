{% load static %}
<!DOCTYPE html>
<html lang="en" class="theme-light">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sarva{% endblock %}</title>

    <!-- Tailwind + DaisyUI -->
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
    <!-- Your theme CSS -->
    <link rel="stylesheet" href="{% static 'css/themes.css' %}">

    <script>
        (function() {
            const savedTheme = localStorage.getItem('sarva-theme') || 'light';
            document.documentElement.className = `theme-${savedTheme}`;
        })();
    </script>
</head>
<body class="bg-base-100 text-base-content">
<div class="navbar px-6">
    <div class="flex-1">
        <a class="text-xl font-bold" href="/">Sarva</a>
    </div>
    <div class="flex gap-4 items-center">
        <!-- Your pages -->
        <a class="btn btn-ghost" href="/quizzes/">Quizzes</a>
        <a class="btn btn-ghost" href="/notes/">Notes</a>
        <a class="btn btn-ghost" href="/motivation/">Motivation</a>
        <a class="btn btn-ghost" href="/performance/">Performance</a>
        <a class="btn btn-ghost" href="/rankings/">Rank</a>
        <a class="btn btn-ghost" href="/games/">Games</a>
        <a class="btn btn-ghost" href="/assistant/">AI</a>

        <!-- Theme Switcher -->
        <select id="theme-select" class="select select-sm select-bordered bg-white text-black">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="pastel">Pastel</option>
            <option value="corporate">Corporate</option>
        </select>
    </div>
</div>

<main class="p-6">
    {% block content %}
    {% endblock %}
</main>

<footer class="footer footer-center p-4 mt-12">
    <p>¬© 2025 Sarva ‚Äî All rights reserved</p>
</footer>

<script>
    const themeSelect = document.getElementById('theme-select');

    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('sarva-theme') || 'light';
        document.documentElement.className = `theme-${savedTheme}`;
        themeSelect.value = savedTheme;
    });

    themeSelect.addEventListener('change', (e) => {
        const newTheme = e.target.value;
        document.documentElement.className = `theme-${newTheme}`;
        localStorage.setItem('sarva-theme', newTheme);
    });
</script>

<!-- Floating Notes Button -->
<button onclick="toggleNotes()" class="fixed bottom-6 right-6 z-50 bg-primary text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
    <img src="{% static 'images/notes-icon.svg' %}" alt="Notes" class="w-8 h-8">
</button>

<!-- Notes Drawer -->
<div id="notes-panel" class="fixed bottom-0 right-0 w-80 bg-base-200 border-l border-t border-gray-300 shadow-lg transform translate-y-full transition-transform duration-300">
    <div class="p-4 border-b border-gray-300 flex justify-between items-center">
        <h2 class="font-bold text-lg">My Notes</h2>
        <button onclick="toggleNotes()" class="btn btn-xs btn-error">Close</button>
    </div>
    <div class="p-4 space-y-2 overflow-y-auto max-h-60" id="notes-list"></div>
    <div class="p-4 border-t border-gray-300">
        <textarea id="note-content" class="textarea textarea-bordered w-full" placeholder="Write a note..."></textarea>
        <button onclick="saveNote()" class="btn btn-success mt-2 w-full">Save</button>
    </div>
</div>

<script>
function toggleNotes() {
    const panel = document.getElementById('notes-panel');
    panel.classList.toggle('translate-y-full');
}

function loadNotes() {
    fetch('/notes/get/')
        .then(res => res.json())
        .then(data => {
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            data.notes.forEach(note => {
                list.innerHTML += `
                    <div class="p-2 bg-base-100 rounded shadow flex justify-between items-start">
                        <div class="flex-1" id="note-content-${note.id}">
                            ${note.content}
                        </div>
                        <div class="flex flex-col gap-1 ml-2">
                            <button class="btn btn-xs btn-warning" onclick="editNotePrompt(${note.id}, '${note.content.replace(/'/g, "\\'")}')">‚úè</button>
                            <button class="btn btn-xs btn-error" onclick="deleteNote(${note.id})">üóë</button>
                        </div>
                    </div>
                `;
            });
        });
}

function saveNote() {
    const content = document.getElementById('note-content').value;
    if (content.trim() === '') return;
    fetch('/notes/save/', {
        method: 'POST',
        headers: {'X-CSRFToken': getCookie('csrftoken')},
        body: new URLSearchParams({'content': content})
    }).then(() => {
        document.getElementById('note-content').value = '';
        loadNotes();
    });
}

function editNotePrompt(noteId, oldContent) {
    const newContent = prompt("Edit your note:", oldContent);
    if (newContent && newContent.trim() !== '') {
        fetch(`/notes/edit/${noteId}/`, {
            method: 'POST',
            headers: {'X-CSRFToken': getCookie('csrftoken')},
            body: new URLSearchParams({'content': newContent})
        }).then(() => loadNotes());
    }
}

function deleteNote(noteId) {
    if (confirm("Are you sure you want to delete this note?")) {
        fetch(`/notes/delete/${noteId}/`, {
            method: 'POST',
            headers: {'X-CSRFToken': getCookie('csrftoken')}
        }).then(() => loadNotes());
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        document.cookie.split(';').forEach(cookie => {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            }
        });
    }
    return cookieValue;
}

document.getElementById('notes-panel').addEventListener('transitionend', function() {
    if (!this.classList.contains('translate-y-full')) loadNotes();
});
</script>

{% if user.is_authenticated %}
    {% include "notes/notes_panel.html" %}
{% endif %}


</body>
</html>
